---
phase: 03-pwa-enhancement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - madplan-v2/src/components/ugeplan/week-swiper.tsx
  - madplan-v2/src/components/ugeplan/week-slide.tsx
  - madplan-v2/src/hooks/use-swipe-week.ts
  - madplan-v2/package.json
autonomous: true
user_setup: []

must_haves:
  truths:
    - "WeekSwiper component renders with Embla carousel"
    - "Swipe gesture changes selected slide index"
    - "Arrow button callbacks trigger scroll navigation"
    - "Hard stop at week boundaries (no infinite scroll)"
  artifacts:
    - path: "madplan-v2/src/components/ugeplan/week-swiper.tsx"
      provides: "Embla carousel wrapper for week slides"
      exports: ["WeekSwiper"]
    - path: "madplan-v2/src/components/ugeplan/week-slide.tsx"
      provides: "Individual week content container"
      exports: ["WeekSlide"]
    - path: "madplan-v2/src/hooks/use-swipe-week.ts"
      provides: "Hook for Embla state and navigation"
      exports: ["useSwipeWeek"]
  key_links:
    - from: "week-swiper.tsx"
      to: "embla-carousel-react"
      via: "useEmblaCarousel hook"
      pattern: "useEmblaCarousel"
    - from: "use-swipe-week.ts"
      to: "week-swiper.tsx"
      via: "provides emblaRef and navigation functions"
      pattern: "emblaRef.*scrollPrev.*scrollNext"
---

<objective>
Create swipe gesture infrastructure using Embla Carousel for week navigation.

Purpose: Enable native iOS-like swipe gestures for navigating between weeks in the Ugeplan view. This is the foundation for the swipeable week carousel.

Output: WeekSwiper component, WeekSlide component, useSwipeWeek hook, embla-carousel-react installed.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-pwa-enhancement/03-CONTEXT.md
@.planning/phases/03-pwa-enhancement/03-RESEARCH.md

# Key existing files
@madplan-v2/src/components/ugeplan/week-nav.tsx
@madplan-v2/src/lib/week-utils.ts
@madplan-v2/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Embla Carousel and create useSwipeWeek hook</name>
  <files>
    madplan-v2/package.json
    madplan-v2/src/hooks/use-swipe-week.ts
  </files>
  <action>
    1. Install embla-carousel-react:
       ```bash
       cd madplan-v2 && npm install embla-carousel-react
       ```

    2. Create `src/hooks/use-swipe-week.ts` with:
       - useEmblaCarousel with options: loop: false, dragFree: false, startIndex: 4 (current week centered among 9 weeks: -4 to +4)
       - State for: canScrollPrev, canScrollNext, selectedIndex
       - Callbacks: scrollPrev, scrollNext, scrollTo
       - Event listeners for 'select' and 'reInit'
       - Return emblaRef, emblaApi, navigation state and callbacks

    Reference the pattern from 03-RESEARCH.md "Embla Carousel with Button Navigation Sync" section.

    Key configuration per CONTEXT.md:
    - loop: false (hard stop at boundaries)
    - dragFree: false (snap to weeks)
    - startIndex: 4 (current week at center of 9 week range)
  </action>
  <verify>
    - `npm list embla-carousel-react` shows 8.x installed
    - `src/hooks/use-swipe-week.ts` exports useSwipeWeek
    - Hook returns { emblaRef, scrollPrev, scrollNext, canPrev, canNext, selectedIndex }
  </verify>
  <done>
    embla-carousel-react installed and useSwipeWeek hook created with Embla configuration
  </done>
</task>

<task type="auto">
  <name>Task 2: Create WeekSlide and WeekSwiper components</name>
  <files>
    madplan-v2/src/components/ugeplan/week-slide.tsx
    madplan-v2/src/components/ugeplan/week-swiper.tsx
  </files>
  <action>
    1. Create `src/components/ugeplan/week-slide.tsx`:
       - Props: children (React.ReactNode)
       - Wrapper div with: flex-[0_0_100%] min-w-0 (Embla slide sizing)
       - Add touch-pan-y class to allow vertical scroll within slide

    2. Create `src/components/ugeplan/week-swiper.tsx`:
       - Props: children (React.ReactNode[]), onSlideChange (index: number) => void
       - Import and use useSwipeWeek hook
       - Embla container structure:
         - Outer div with ref={emblaRef}, overflow-hidden
         - Inner div with flex, touch-pan-y
         - Render children as slides
       - Apply CSS to prevent browser back gesture:
         - touch-action: pan-y on container
         - overscroll-behavior-x: contain on container
       - Expose scrollPrev, scrollNext, canPrev, canNext via forwardRef or render props

    Reference 03-RESEARCH.md patterns and pitfalls:
    - Pitfall 1: Apply touch-action: pan-y and overscroll-behavior-x: contain
    - Pitfall 3: Embla handles swipe vs scroll angle detection automatically
  </action>
  <verify>
    - `src/components/ugeplan/week-slide.tsx` exports WeekSlide
    - `src/components/ugeplan/week-swiper.tsx` exports WeekSwiper
    - WeekSwiper uses useSwipeWeek hook
    - CSS classes include touch-pan-y and overscroll-behavior-x: contain
  </verify>
  <done>
    WeekSlide and WeekSwiper components created with proper Embla structure and CSS to prevent browser gesture conflicts
  </done>
</task>

</tasks>

<verification>
1. Package check: `cd madplan-v2 && npm list embla-carousel-react` shows version 8.x
2. Type check: `cd madplan-v2 && npx tsc --noEmit` passes
3. Files exist:
   - src/hooks/use-swipe-week.ts
   - src/components/ugeplan/week-slide.tsx
   - src/components/ugeplan/week-swiper.tsx
</verification>

<success_criteria>
1. embla-carousel-react is installed
2. useSwipeWeek hook provides Embla integration with navigation callbacks
3. WeekSwiper component renders children as swipeable slides
4. WeekSlide component wraps individual week content
5. CSS prevents browser back gesture conflicts (touch-action, overscroll-behavior)
6. TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-pwa-enhancement/03-01-SUMMARY.md`
</output>
