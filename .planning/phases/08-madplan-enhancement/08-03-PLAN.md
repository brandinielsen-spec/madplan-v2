---
phase: 08-madplan-enhancement
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - madplan-v2/src/app/ugeplan/page.tsx
  - madplan-v2/src/hooks/use-view-preference.ts
  - madplan-v2/src/components/ugeplan/day-card-list.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can toggle between grid and list view on ugeplan"
    - "View preference persists across page refreshes"
    - "Both views display meal name and note when present"
    - "Toggle button is positioned top-right near week navigation"
  artifacts:
    - path: "madplan-v2/src/hooks/use-view-preference.ts"
      provides: "localStorage-backed view preference hook"
      exports: ["useViewPreference"]
    - path: "madplan-v2/src/app/ugeplan/page.tsx"
      provides: "View toggle UI and conditional rendering"
      contains: "ToggleGroup"
    - path: "madplan-v2/src/components/ugeplan/day-card-list.tsx"
      provides: "Compact list row alternative to DayCard"
      exports: ["DayCardList"]
  key_links:
    - from: "ugeplan/page.tsx"
      to: "use-view-preference.ts"
      via: "hook call"
      pattern: "useViewPreference"
    - from: "ugeplan/page.tsx"
      to: "localStorage"
      via: "preference persistence"
      pattern: "ugeplan-view"
---

<objective>
Add list/grid view toggle to the ugeplan page so users can choose their preferred layout.

Purpose: Implements UI-01 - some users prefer compact list view for quick scanning, others prefer visual grid with images.
Output: View toggle with localStorage persistence, list view component, conditional rendering in page.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-madplan-enhancement/08-CONTEXT.md
@.planning/phases/08-madplan-enhancement/08-RESEARCH.md

@madplan-v2/src/app/ugeplan/page.tsx
@madplan-v2/src/app/opskrifter/page.tsx (view toggle pattern reference)
@madplan-v2/src/components/ugeplan/day-card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useViewPreference hook</name>
  <files>madplan-v2/src/hooks/use-view-preference.ts</files>
  <action>
Create a custom hook for persisting view preference to localStorage:

```typescript
'use client'

import { useState, useEffect, useCallback } from 'react'

type ViewMode = 'grid' | 'list'

export function useViewPreference(
  key: string,
  defaultValue: ViewMode = 'grid'
): [ViewMode, (value: ViewMode) => void] {
  // Initialize from localStorage or default
  // Handle SSR by checking typeof window
  const [view, setView] = useState<ViewMode>(defaultValue)
  const [hydrated, setHydrated] = useState(false)

  // Hydrate from localStorage after mount (SSR-safe)
  useEffect(() => {
    const stored = localStorage.getItem(key)
    if (stored === 'grid' || stored === 'list') {
      setView(stored)
    }
    setHydrated(true)
  }, [key])

  const setViewAndPersist = useCallback((newView: ViewMode) => {
    setView(newView)
    localStorage.setItem(key, newView)
  }, [key])

  return [view, setViewAndPersist]
}
```

Key considerations:
- SSR-safe: Don't access localStorage during initial render
- Hydration: Update state after mount to match localStorage
- Type-safe: Only accept 'grid' | 'list'
  </action>
  <verify>Hook compiles, can be imported and called</verify>
  <done>Hook reads/writes localStorage, handles SSR correctly</done>
</task>

<task type="auto">
  <name>Task 2: Add view toggle and list view to ugeplan page</name>
  <files>madplan-v2/src/app/ugeplan/page.tsx, madplan-v2/src/components/ugeplan/day-card-list.tsx</files>
  <action>
1. Create DayCardList component (list row variant):
   - Compact horizontal row layout
   - Small thumbnail (w-10 h-10) or initial letter
   - Day name, date, recipe title, note all on one row
   - Same action buttons (add to cart, delete, add) but smaller
   - Props match DayCard for easy switching

2. In ugeplan/page.tsx:
   - Import ToggleGroup, ToggleGroupItem, LayoutGrid, List icons
   - Import useViewPreference hook
   - Add view state: const [viewMode, setViewMode] = useViewPreference('ugeplan-view', 'grid')
   - Add ToggleGroup near WeekNav (same row, right side):
     ```tsx
     <div className="flex items-center justify-between mb-4">
       <WeekNav ... />
       <ToggleGroup type="single" value={viewMode} onValueChange={...}>
         <ToggleGroupItem value="grid"><LayoutGrid /></ToggleGroupItem>
         <ToggleGroupItem value="list"><List /></ToggleGroupItem>
       </ToggleGroup>
     </div>
     ```
   - Conditional rendering in WeekContent:
     - grid: Use existing DayCard components (current behavior)
     - list: Use DayCardList components

3. Layout considerations:
   - Grid view: Current card layout (default)
   - List view: Compact rows, more info visible at once
   - Both views show: day, date, meal name, note, action buttons
   - Toggle matches opskrifter page style for consistency
  </action>
  <verify>
    1. Toggle appears next to week navigation
    2. Clicking toggle switches between layouts
    3. Refreshing page remembers last selection
    4. Both views are functional (add, delete, shopping cart work)
  </verify>
  <done>Users can toggle between grid/list views, preference persists</done>
</task>

</tasks>

<verification>
- [ ] View toggle visible near week navigation
- [ ] Grid view shows current DayCard layout
- [ ] List view shows compact row layout
- [ ] Toggle state persists in localStorage
- [ ] Page refresh maintains view preference
- [ ] Both views support all day card actions
- [ ] Notes display in both views (when implemented by 08-02)
- [ ] No hydration mismatch warnings
- [ ] Build passes
</verification>

<success_criteria>
1. UI-01 resolved: Ugeplan has working list/grid toggle
2. Preference persists across sessions via localStorage
3. Both views are fully functional (no feature loss in list view)
4. Toggle UI is consistent with opskrifter page pattern
</success_criteria>

<output>
After completion, create `.planning/phases/08-madplan-enhancement/08-03-SUMMARY.md`
</output>
