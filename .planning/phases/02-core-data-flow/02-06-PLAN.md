---
phase: 02-core-data-flow
plan: 06
type: execute
wave: 3
depends_on: ["02-02", "02-03"]
files_modified:
  - madplan-v2/src/components/opskrifter/recipe-card.tsx
  - madplan-v2/src/components/opskrifter/recipe-list-item.tsx
  - madplan-v2/src/app/opskrifter/page.tsx
autonomous: false

must_haves:
  truths:
    - "User can see list of recipes"
    - "User can toggle between card and list view"
    - "User can tap recipe to see details (navigates to detail page)"
  artifacts:
    - path: "madplan-v2/src/components/opskrifter/recipe-card.tsx"
      provides: "Visual recipe card with title"
      exports: ["RecipeCard"]
    - path: "madplan-v2/src/components/opskrifter/recipe-list-item.tsx"
      provides: "Compact list item for recipes"
      exports: ["RecipeListItem"]
    - path: "madplan-v2/src/app/opskrifter/page.tsx"
      provides: "Recipe list page with view toggle"
      contains: "useOpskrifter"
  key_links:
    - from: "madplan-v2/src/app/opskrifter/page.tsx"
      to: "madplan-v2/src/hooks/use-opskrifter.ts"
      via: "useOpskrifter hook import"
      pattern: "useOpskrifter"
---

<objective>
Build the recipe list view with card/list toggle.

Purpose: Users can browse their recipes in either visual (cards) or compact (list) format. Tapping a recipe will navigate to detail page (detail page deferred to later).

Output: Recipe card component, list item component, and wired opskrifter page with view toggle.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-core-data-flow/02-CONTEXT.md
@.planning/phases/02-core-data-flow/02-RESEARCH.md
@.planning/phases/02-core-data-flow/02-01-SUMMARY.md
@.planning/phases/02-core-data-flow/02-02-SUMMARY.md
@.planning/phases/02-core-data-flow/02-03-SUMMARY.md

# Types
@madplan-v2/src/lib/types.ts

# SWR hook
@madplan-v2/src/hooks/use-opskrifter.ts

# Existing placeholder page
@madplan-v2/src/app/opskrifter/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create recipe card and list item components</name>
  <files>
    madplan-v2/src/components/opskrifter/recipe-card.tsx
    madplan-v2/src/components/opskrifter/recipe-list-item.tsx
  </files>
  <action>
Create components directory: `src/components/opskrifter/`

Create `src/components/opskrifter/recipe-card.tsx`:

```typescript
'use client'

import Link from 'next/link'
import { Card, CardContent } from '@/components/ui/card'
import type { Opskrift } from '@/lib/types'

interface RecipeCardProps {
  recipe: Opskrift
}

export function RecipeCard({ recipe }: RecipeCardProps) {
  return (
    <Link href={`/opskrifter/${recipe.id}`}>
      <Card className="overflow-hidden hover:ring-2 hover:ring-terracotta-300 transition-shadow cursor-pointer">
        {/* Placeholder for image - will show colored background */}
        <div className="aspect-[4/3] bg-gradient-to-br from-olive-200 to-sand-200 flex items-center justify-center">
          <span className="text-4xl text-olive-600/30 font-heading">
            {recipe.titel.charAt(0).toUpperCase()}
          </span>
        </div>
        <CardContent className="p-3">
          <h3 className="font-medium text-foreground truncate">
            {recipe.titel}
          </h3>
          <p className="text-sm text-muted-foreground">
            {recipe.portioner} portioner
          </p>
        </CardContent>
      </Card>
    </Link>
  )
}
```

Create `src/components/opskrifter/recipe-list-item.tsx`:

```typescript
'use client'

import Link from 'next/link'
import { ChevronRight } from 'lucide-react'
import type { Opskrift } from '@/lib/types'

interface RecipeListItemProps {
  recipe: Opskrift
}

export function RecipeListItem({ recipe }: RecipeListItemProps) {
  return (
    <Link
      href={`/opskrifter/${recipe.id}`}
      className="flex items-center gap-3 py-3 px-4 hover:bg-sand-100 transition-colors cursor-pointer"
    >
      {/* Small letter avatar */}
      <div className="w-10 h-10 rounded-full bg-olive-200 flex items-center justify-center flex-shrink-0">
        <span className="text-lg font-medium text-olive-700">
          {recipe.titel.charAt(0).toUpperCase()}
        </span>
      </div>

      <div className="flex-1 min-w-0">
        <h3 className="font-medium text-foreground truncate">
          {recipe.titel}
        </h3>
        <p className="text-sm text-muted-foreground">
          {recipe.portioner} portioner
        </p>
      </div>

      <ChevronRight className="h-5 w-5 text-muted-foreground flex-shrink-0" />
    </Link>
  )
}
```

Note: Images are not yet in the schema. Cards show the first letter of the recipe title as a placeholder. When images are added in Phase 4 (Smart Import), these components can be updated.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify components compile.
  </verify>
  <done>
RecipeCard and RecipeListItem components created with placeholder visuals.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire opskrifter page with data and view toggle</name>
  <files>madplan-v2/src/app/opskrifter/page.tsx</files>
  <action>
Replace the placeholder opskrifter/page.tsx with the fully wired version:

```typescript
'use client'

import { useState, useMemo } from 'react'
import { AppShell } from '@/components/layout/app-shell'
import { RecipeCard } from '@/components/opskrifter/recipe-card'
import { RecipeListItem } from '@/components/opskrifter/recipe-list-item'
import { Input } from '@/components/ui/input'
import { ToggleGroup, ToggleGroupItem } from '@/components/ui/toggle-group'
import { Skeleton } from '@/components/ui/skeleton'
import { Card, CardContent } from '@/components/ui/card'
import { Search, LayoutGrid, List } from 'lucide-react'
import { useOpskrifter } from '@/hooks/use-opskrifter'
import { useEjere } from '@/hooks/use-ejere'

type ViewMode = 'cards' | 'list'

export default function OpskrifterPage() {
  const [viewMode, setViewMode] = useState<ViewMode>('cards')
  const [search, setSearch] = useState('')

  // TODO: ejerId from user context - for now use first ejer
  const { ejere, isLoading: ejereLoading } = useEjere()
  const ejerId = ejere[0]?.id ?? null

  const {
    opskrifter,
    isLoading: opskrifterLoading,
    isError,
  } = useOpskrifter(ejerId)

  // Filter recipes by search
  const filteredOpskrifter = useMemo(() => {
    if (!search.trim()) return opskrifter
    const searchLower = search.toLowerCase()
    return opskrifter.filter((o) =>
      o.titel.toLowerCase().includes(searchLower)
    )
  }, [opskrifter, search])

  const isLoading = ejereLoading || opskrifterLoading

  return (
    <AppShell title="Opskrifter">
      {/* Search and view toggle */}
      <div className="flex gap-2 mb-4">
        <div className="relative flex-1">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
          <Input
            type="search"
            placeholder="Soeg i opskrifter..."
            value={search}
            onChange={(e) => setSearch(e.target.value)}
            className="pl-9"
          />
        </div>
        <ToggleGroup
          type="single"
          value={viewMode}
          onValueChange={(value) => value && setViewMode(value as ViewMode)}
          className="border rounded-md"
        >
          <ToggleGroupItem value="cards" aria-label="Vis som kort">
            <LayoutGrid className="h-4 w-4" />
          </ToggleGroupItem>
          <ToggleGroupItem value="list" aria-label="Vis som liste">
            <List className="h-4 w-4" />
          </ToggleGroupItem>
        </ToggleGroup>
      </div>

      {isLoading ? (
        viewMode === 'cards' ? (
          <div className="grid grid-cols-2 gap-3">
            {Array.from({ length: 6 }).map((_, i) => (
              <Skeleton key={i} className="aspect-[4/3]" />
            ))}
          </div>
        ) : (
          <div className="space-y-2">
            {Array.from({ length: 6 }).map((_, i) => (
              <Skeleton key={i} className="h-16 w-full" />
            ))}
          </div>
        )
      ) : isError ? (
        <Card>
          <CardContent className="py-8 text-center text-muted-foreground">
            <p>Kunne ikke hente opskrifter</p>
            <p className="text-sm mt-1">Tjek din forbindelse og proev igen</p>
          </CardContent>
        </Card>
      ) : filteredOpskrifter.length === 0 ? (
        <Card>
          <CardContent className="py-8 text-center text-muted-foreground">
            {search ? (
              <p>Ingen opskrifter matcher "{search}"</p>
            ) : (
              <>
                <p>Ingen opskrifter endnu</p>
                <p className="text-sm mt-1">Tilfoej opskrifter fra Tilfoej-fanen</p>
              </>
            )}
          </CardContent>
        </Card>
      ) : viewMode === 'cards' ? (
        <div className="grid grid-cols-2 gap-3 pb-4">
          {filteredOpskrifter.map((recipe) => (
            <RecipeCard key={recipe.id} recipe={recipe} />
          ))}
        </div>
      ) : (
        <Card className="divide-y divide-sand-200">
          {filteredOpskrifter.map((recipe) => (
            <RecipeListItem key={recipe.id} recipe={recipe} />
          ))}
        </Card>
      )}
    </AppShell>
  )
}
```

Key features:
- Search input filters recipes by title
- Toggle between cards (2 columns, visual) and list (compact)
- Cards default - matches decision in CONTEXT.md
- Recipe tap navigates to /opskrifter/[id] (detail page placeholder)
- Loading skeletons match the current view mode
- Empty states for no recipes and no search results
  </action>
  <verify>
Run `npm run dev` and navigate to /opskrifter.
Check that search filters recipes.
Check that view toggle switches between cards and list.
  </verify>
  <done>
Opskrifter page wired with RecipeCard, RecipeListItem, search, and view toggle.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create recipe detail page placeholder</name>
  <files>madplan-v2/src/app/opskrifter/[id]/page.tsx</files>
  <action>
Create `src/app/opskrifter/[id]/page.tsx` as a placeholder for recipe detail view:

```typescript
'use client'

import { useParams } from 'next/navigation'
import { AppShell } from '@/components/layout/app-shell'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Skeleton } from '@/components/ui/skeleton'
import { ArrowLeft } from 'lucide-react'
import Link from 'next/link'
import useSWR from 'swr'
import type { Opskrift } from '@/lib/types'
import { useEjere } from '@/hooks/use-ejere'

export default function OpskriftDetailPage() {
  const params = useParams()
  const opskriftId = params.id as string

  // TODO: ejerId from user context
  const { ejere, isLoading: ejereLoading } = useEjere()
  const ejerId = ejere[0]?.id ?? null

  // Fetch single recipe - for now, fetch all and filter
  // Could optimize with dedicated endpoint later
  const { data: opskrifter, isLoading: opskrifterLoading } = useSWR<Opskrift[]>(
    ejerId ? `/api/madplan/opskrifter?ejerId=${ejerId}` : null
  )

  const opskrift = opskrifter?.find((o) => o.id === opskriftId)
  const isLoading = ejereLoading || opskrifterLoading

  return (
    <AppShell
      title={opskrift?.titel ?? 'Opskrift'}
      headerLeft={
        <Link href="/opskrifter">
          <Button variant="ghost" size="icon">
            <ArrowLeft className="h-5 w-5" />
          </Button>
        </Link>
      }
    >
      {isLoading ? (
        <div className="space-y-4">
          <Skeleton className="h-8 w-3/4" />
          <Skeleton className="h-4 w-1/4" />
          <Skeleton className="h-32 w-full" />
          <Skeleton className="h-48 w-full" />
        </div>
      ) : !opskrift ? (
        <Card>
          <CardContent className="py-8 text-center text-muted-foreground">
            <p>Opskrift ikke fundet</p>
            <Link href="/opskrifter" className="text-primary underline mt-2 inline-block">
              Tilbage til opskrifter
            </Link>
          </CardContent>
        </Card>
      ) : (
        <div className="space-y-4 pb-4">
          {/* Title and portions */}
          <div>
            <h1 className="text-2xl font-heading font-bold">{opskrift.titel}</h1>
            <p className="text-muted-foreground">{opskrift.portioner} portioner</p>
          </div>

          {/* Ingredients */}
          <Card>
            <CardHeader>
              <CardTitle className="text-lg">Ingredienser</CardTitle>
            </CardHeader>
            <CardContent>
              <ul className="space-y-1">
                {opskrift.ingredienser.map((ingrediens, i) => (
                  <li key={i} className="text-foreground">
                    {ingrediens}
                  </li>
                ))}
              </ul>
            </CardContent>
          </Card>

          {/* Instructions */}
          <Card>
            <CardHeader>
              <CardTitle className="text-lg">Fremgangsmaade</CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-foreground whitespace-pre-wrap">
                {opskrift.fremgangsmaade}
              </p>
            </CardContent>
          </Card>
        </div>
      )}
    </AppShell>
  )
}
```

Note: This is a read-only detail view. Edit functionality is deferred - it's v1 functionality but wasn't explicitly requested in Phase 2 scope.
  </action>
  <verify>
Run `npm run dev` and click on a recipe card.
Check that detail page shows with back button.
Check that ingredienser and fremgangsmaade display correctly.
  </verify>
  <done>
Recipe detail page created with ingredients, instructions, and back navigation.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 4: Verify opskrifter functionality</name>
  <what-built>
Complete recipe list view with:
- Search input filtering
- Cards/list view toggle
- Recipe cards with visual placeholder
- Compact list items
- Recipe detail page
- Loading and error states
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Navigate to http://localhost:3000/opskrifter
3. Check view modes:
   - Default shows cards (2 columns)
   - Click list icon to switch to compact list
   - Click grid icon to switch back to cards
4. Check search:
   - Type in search box
   - Recipes filter as you type
   - Clear search to show all
5. Check recipe detail:
   - Tap a recipe card/list item
   - Detail page shows with ingredients and instructions
   - Back arrow returns to list
6. Check empty/error states:
   - If no recipes: shows helpful message
   - Network error: shows error message
  </how-to-verify>
  <resume-signal>Type "approved" if opskrifter works, or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. Components exist in src/components/opskrifter/
3. /opskrifter page loads without console errors
4. View toggle switches between cards and list
5. Search filters recipes
6. Tapping recipe navigates to detail page
7. Detail page shows recipe content
</verification>

<success_criteria>
- RecipeCard and RecipeListItem components created
- Opskrifter page with search and view toggle
- Recipe detail page /opskrifter/[id]
- View mode persists during search
- Navigation works without page reload
- No console errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-data-flow/02-06-SUMMARY.md`
</output>
