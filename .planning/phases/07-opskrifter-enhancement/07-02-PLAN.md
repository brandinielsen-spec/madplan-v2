---
phase: 07-opskrifter-enhancement
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Bruger kan se tag-filter chips paa opskrifter-siden"
    - "Bruger kan klikke paa tag-chip for at filtrere"
    - "Kun opskrifter med valgte tags vises efter filter"
    - "Flere valgte tags bruger AND-logik"
  artifacts:
    - path: "madplan-v2/src/app/opskrifter/page.tsx"
      provides: "Tag filtering implementation"
      contains: "selectedTags.every"
    - path: "madplan-v2/src/components/opskrifter/filter-bar.tsx"
      provides: "Tag filter UI"
      contains: "onTagToggle"
  key_links:
    - from: "filter-bar.tsx"
      to: "opskrifter/page.tsx"
      via: "onTagToggle callback"
      pattern: "onTagToggle.*handleTagToggle"
---

<objective>
Verify that tag filtering (BUG-03) is already working as the code analysis suggests.

Purpose: Research shows that tag filtering is already implemented in opskrifter/page.tsx with client-side filtering. This plan verifies the implementation works correctly with real data. If issues are found, they will be documented and fixed.

Output: Confirmation that BUG-03 is complete, or documentation of issues found.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-opskrifter-enhancement/07-RESEARCH.md

# Existing implementation
@madplan-v2/src/app/opskrifter/page.tsx
@madplan-v2/src/components/opskrifter/filter-bar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Test Tag Filtering Functionality</name>
  <files>No file changes expected</files>
  <action>
Systematically verify tag filtering works:

1. Start the dev server if not running:
   ```
   cd madplan-v2 && npm run dev
   ```

2. Ensure test data exists with tags:
   - Open Airtable Opskrifter table directly OR
   - Use the app to add tags to 3+ recipes (requires 07-01 to be complete first)
   - Example tags: "Hurtig", "Vegetar", "Aftensmad"

3. Test filter UI presence:
   - Navigate to http://localhost:3000/opskrifter
   - Verify FilterBar component renders below search bar
   - Verify tag chips appear for all unique tags in recipes

4. Test single tag filter:
   - Click on one tag chip (e.g., "Hurtig")
   - Verify only recipes with that tag are shown
   - Verify the tag chip shows selected state (different styling)

5. Test AND logic with multiple tags:
   - Select a second tag (e.g., "Vegetar")
   - Verify only recipes with BOTH tags are shown
   - If no recipes have both tags, verify empty state appears

6. Test filter clear:
   - Verify clicking selected tag again deselects it
   - Verify recipes reappear when filters cleared

7. Test combined filters:
   - Apply tag filter + search filter + favorites filter
   - Verify all filters work together correctly

POTENTIAL ISSUES TO CHECK:
- Tags not appearing in FilterBar: Check if recipes have tags in Airtable
- Filter not working: Check console for errors in filteredOpskrifter memo
- Styling broken: Check filter-bar.tsx for selected state classes
  </action>
  <verify>
Verification checklist - all must pass:
- [ ] Tag chips appear in FilterBar for recipes that have tags
- [ ] Clicking tag chip filters to show only matching recipes
- [ ] Multiple selected tags use AND logic (stricter filter)
- [ ] Clicking selected tag deselects it
- [ ] Empty state shows when no recipes match filters
- [ ] Combined with search still works
- [ ] Combined with favorites still works
  </verify>
  <done>
BUG-03 verification complete. Either:
A) Tag filtering works correctly - BUG-03 is already resolved
B) Issues documented in SUMMARY.md with specific failures
  </done>
</task>

<task type="auto">
  <name>Task 2: Document Findings or Fix Minor Issues</name>
  <files>Possibly madplan-v2/src/components/opskrifter/filter-bar.tsx or page.tsx if fixes needed</files>
  <action>
Based on Task 1 findings:

**IF WORKING:**
Document in summary that BUG-03 was already implemented and verified working.

**IF MINOR ISSUES FOUND:**
Fix them. Common issues might be:
- Tag chips not showing selected state: Add proper className for selected tags
- Tags not appearing: Check allTags derivation in useOpskrifter hook
- Case sensitivity issues: Normalize tag comparison

**IF MAJOR ISSUES FOUND:**
Document what's broken and what needs to be fixed. This may require a follow-up plan.

Likely scenarios based on code review:
1. Works perfectly - just needs data with tags
2. Works but needs 07-01 complete first to add tags to recipes
3. Minor styling issue with selected state
  </action>
  <verify>
If fixes were made:
- Verify the fix by repeating Task 1 verification steps
- Ensure no regressions in other filter functionality

If no fixes needed:
- Confirm feature works as documented
  </verify>
  <done>
BUG-03 status documented. Either verified working or issues documented for follow-up.
  </done>
</task>

</tasks>

<verification>
Phase requirement verification:

| Requirement | How to Verify | Expected Result |
|-------------|---------------|-----------------|
| BUG-03: Filter efter tags | Select tag in FilterBar, check filtered results | Only recipes with selected tag(s) visible |
</verification>

<success_criteria>
1. FilterBar shows tag chips when recipes have tags
2. Selecting a tag filters the recipe list correctly
3. Multiple tags use AND logic (recipe must have ALL selected tags)
4. Filter can be combined with search and favorites filter
5. Either verified working or issues documented for follow-up
</success_criteria>

<output>
After completion, create `.planning/phases/07-opskrifter-enhancement/07-02-SUMMARY.md`
</output>
